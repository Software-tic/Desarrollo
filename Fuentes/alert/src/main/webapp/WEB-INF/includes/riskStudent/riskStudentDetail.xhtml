<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
	<p:panel header="#{bundle['page.riskStudent.labelStudentRegister']}"> 
		<table width="100%" border="0" cellpadding="5" cellspacing="5">
			<tr>
				<td style="width:5%;" />
				<td style="width:5%;" />
				<td style="width:12%;" />
				<td style="width:26%;" />
				<td style="width:4%;" />
				<td style="width:12%;" />
				<td style="width:26%;" />
				<td style="width:5%;" />
				<td style="width:5%;" />
			</tr>
			<tr>
				<td colspan="2" />
				<td> <h:outputText value="#{bundle['page.riskStudent.labelStudent']}:" rendered="#{!reportStudentBean.getValidateUserRole(7,8)}">  </h:outputText> </td>  
				<td><h:outputText id="txtNameStudent"  rendered="#{!reportStudentBean.getValidateUserRole(7,8)}"
						value="#{reportStudentBean.reportStudentSelected.zyosUserName} #{reportStudentBean.reportStudentSelected.zyosUserLastName}"
						style="width:98%;" /></td>
				<td />
				<td>#{bundle['page.riskStudent.labelDate']}:</td>
				<td><h:outputText id="txtDate"
						value="#{reportStudentBean.reportStudentSelected.dateCreation}"
						style="width:98%;" /></td>
			</tr>
			<p:outputPanel
				rendered="#{reportStudentBean.reportStudentSelected.nameResponsible ne null}">
				<tr>
					<td colspan="2" />
					<td>#{bundle['page.riskStudent.labelReportBy']}:</td>
					<td><h:outputText id="txtReportBys"
							value="#{reportStudentBean.reportStudentSelected.nameResponsible}"
							style="width:98%;" /></td>
					<td />
					<td>#{bundle['page.riskStudent.labelRole']}:</td>
					<td><h:outputText id="txtStartedBys"
							value="#{riskStudent.idReportType eq 2 ? 'Reporte automatico': riskStudent.zyosGroupName eq null ? 'Usuario externo': riskStudent.zyosGroupName}"
							style="width:98%;" /></td>
				</tr>
			</p:outputPanel>
			<p:outputPanel
				rendered="#{reportStudentBean.reportStudentSelected.nameResponsible eq null}">
				<tr>
					<td colspan="2" />
					<td>#{bundle['page.riskStudent.labelReportBy']}:</td>
					<td><h:outputText id="txtReportBy"
							value="#{reportStudentBean.reportStudentSelected.nameSolicitor}"
							style="width:98%;" /></td>
					<td />
					<td>#{bundle['page.riskStudent.labelRole']}:</td>
					<td><h:outputText id="txtStartedBy"
							value="#{reportStudentBean.reportStudentSelected.zyosGroupName}"
							style="width:98%;" /></td>
				</tr>
			</p:outputPanel>

			<p:outputPanel id="responsibleDataPanel"
				rendered="#{reportStudentBean.reportStudentSelected.nameResponsible ne null}">
				<tr>
					<td />
					<td colspan="7" align="center"
						style="background-color: #F2ECEC;"
							height="30"><b>#{bundle['page.student.labelResponsibleData']}</b>
					</td>

					<td />
				</tr>
				<tr>
					<td><p:spacer height="15" /></td>
				</tr>
				<tr>
					<td colspan="2" />
					<td colspan="1">#{bundle['page.riskStudentDetail.labelName']}:
						<td> <h:outputText id="txtNameResponsible"  
							value="#{reportStudentBean.reportStudentSelected.nameResponsible}"
							style="width:98%;" /> </td>
					</td>
					<td />
					<td >Email: 
						 <td>  <h:outputText id="txtEmailResponsible"
							value="#{reportStudentBean.reportStudentSelected.emailSolicitor}"
							style="width:98%;" /> </td>
					</td>
					<td />
				</tr>
				<tr>
					<td colspan="2" />
					<td>#{bundle['page.user.labelCellPhone']}:</td>
					<td><h:outputText id="txtMobileResponsible" style="width:95%;"
							value="#{reportStudentBean.reportStudentSelected.mobilePhoneResponsible == 0 ? '':reportStudentBean.reportStudentSelected.mobilePhoneResponsible }" />
					</td>
					<td />
					<td>#{bundle['page.user.labelPhone']}:</td>
					<td><h:outputText id="txtPhoneResponsible"
							value="#{reportStudentBean.reportStudentSelected.phoneResponsible == 0 ? '':reportStudentBean.reportStudentSelected.phoneResponsible}"
							style="width:95%;" /></td>
					<td />
				</tr>
			</p:outputPanel>
			
			<p:outputPanel rendered="#{!reportStudentBean.getValidateUserRole(9,8)}"> 
			<tr>
				<td><p:spacer height="15" /></td>
			</tr>
			<tr>
				<td />
				<td colspan="7" align="center"
					style="background-color: #F2ECEC;"
							height="30"><b> #{bundle['page.riskStudent.labelRiskFactor']}</b>
				</td>
				<td />
			</tr>
			<tr>
				<td />
				<td colspan="7" align="center"><h:outputText
						value="#{reportStudentBean.reportStudentSelected.riskFactorName}" />
				</td>
				<td />
				<td />
				<td />
			</tr>
			</p:outputPanel>
			
			<p:outputPanel rendered="#{!reportStudentBean.getValidateUserRole(10,8)}"> 
			<tr>
				<td><p:spacer height="15" /></td>
			</tr>
			<tr>
				<td />
				<td colspan="7" align="center"
					style="background-color: #F2ECEC;"
							height="30"><b>#{bundle['page.ins.labelObservation']}</b></td>
				<td />
			</tr>
			<tr>
				<td colspan="2" />
				<td colspan="5"><h:outputText id="txtObservationStudent"
						value="#{reportStudentBean.reportStudentSelected.detailReport}"
						style="width:98%;" /></td>
				<td />
			</tr>
			<tr>
				<td><p:spacer height="15" /></td>
			</tr>
			<tr>
				<td colspan="2" />

				<p:outputPanel
					rendered="#{reportStudentBean.getUserSession().getDefaultGroup() ne 5 }">
					<td colspan="2"><p:commandButton immediate="true"
							action="#{reportStudentBean.goProcess}"
							value="#{bundle['page.riskStudent.labelGiveProcess']}"
							update=":riskStudentForm:processPanel"
							styleClass="ui-priority-primary"></p:commandButton></td>
				</p:outputPanel>
				<td colspan="2"><p:commandButton immediate="true"
						action="#{reportStudentBean.goHistoricalProcess}"
						value="#{bundle['page.subject.subjectDetail.labelHistorical']}"
						update=":riskStudentForm:processPanel"
						styleClass="ui-priority-primary"></p:commandButton></td>
				<td></td>
			</tr>
			</p:outputPanel>
		</table>
		<p:outputPanel id="processPanel">
			<p:outputPanel rendered="#{!reportStudentBean.showProcess}">
				<table width="100%" border="0" cellpadding="5" cellspacing="5">
					<tr>
						<td width="5%" />
						<td width="5%" />
						<td width="12%" />
						<td width="26%" />
						<td width="4%" />
						<td width="12%" />
						<td width="26%" />
						<td width="5%" />
						<td width="5%" />
					</tr>

					<p:outputPanel id="referToOutputPanel"
						rendered="#{reportStudentBean.getUserSession().getDefaultGroup() eq 1 or reportStudentBean.getUserSession().getDefaultGroup() eq 15 }">
						<tr>
							<td colspan="2" />
							<td><h:outputText
									value="#{bundle['page.riskStudent.labelReferTo']}:" /></td>
							<td><p:selectOneMenu id="stage" style="width:160px" panelStyle="width:160px" panelStyleClass="ui-selectonemenu-panel-warper"
									value="#{reportStudentBean.reportStudentSelected.idStage}" >
									<f:selectItem itemLabel="#{bundle['page.core.selectOne']}"  />
									<f:selectItems value="#{reportStudentBean.getStageList()}"
										var="stage" itemLabel="#{stage.name}" itemValue="#{stage.id}" />
									<p:ajax global="false"
										listener="#{reportStudentBean.loadResponsibleListByRole()}"
										update="menuResponsible" />
								</p:selectOneMenu>
								<div id="stageDiv" class="LV_invalid" /></td>
							<td />
							<td><h:outputText
									value="#{bundle['page.riskStudent.labelResponsible']}:" /></td>
							<td><p:selectOneMenu id="menuResponsible" panelStyle="width:160px" panelStyleClass="ui-selectonemenu-panel-warper"
									value="#{reportStudentBean.reportStudentSelected.idAdviser}">
									<f:selectItem itemLabel="#{bundle['page.core.selectOne']}" />
									<f:selectItems value="#{reportStudentBean.responsibleList}"
										var="resp" itemValue="#{resp.idZyosUser}"
										itemLabel="#{resp.name} #{resp.lastName}" />
								</p:selectOneMenu>
								<div id="responsibleDiv" class="LV_invalid" /></td>
						</tr>
					</p:outputPanel>
					<p:outputPanel id="stateOutputPanel"
						rendered="#{reportStudentBean.getUserSession().getDefaultGroup() ne 5 }">

						<tr>
							<td colspan="2" />
							<td><h:outputText value="#{bundle['page.user.labelState']}:" />
							</td>
							<td><p:selectOneMenu id="state" panelStyle="width:160px" panelStyleClass="ui-selectonemenu-panel-warper"
									value="#{reportStudentBean.reportStudentSelected.idStatusReportStudent}">
									<f:selectItem itemLabel="#{bundle['page.core.selectOne']}" />
									<f:selectItems
										value="#{reportStudentBean.statusReportStudentList}"
										var="status" itemLabel="#{status.name}"
										itemValue="#{status.id}" />
								</p:selectOneMenu>
								<div id="stateDiv" class="LV_invalid" /></td>
						</tr>
						<tr>
							<td colspan="2" />
							<td colspan="5"><p:inputTextarea rows="5" maxlength="999" autoResize="false" id="observationArea"
									value="#{reportStudentBean.reportStudentData.detailReport}"
									style="width:98%" /></td>
						</tr>
					</p:outputPanel>
				</table>
			</p:outputPanel>

			<p:outputPanel id="historicPanel">
				<table width="100%" border="0" cellpadding="5" cellspacing="5">
					<tr>
						<td width="5%" />
						<td width="5%" />
						<td width="12%" />
						<td width="26%" />
						<td width="4%" />
						<td width="12%" />
						<td width="26%" />
						<td width="5%" />
						<td width="5%" />
					</tr>
					<tr> 
					<td colspan="9" style="text-align: center"> 
					<p:commandLink rendered="#{reportStudentBean.showProcess}" title="Exportar a Excel" ajax="false">
							<p:graphicImage cache="false" height="27" width="27"
								value="../css/images/xlsx-report.png" />
							<p:dataExporter target="observationDataTable" type="xls"
							postProcessor="#{reportStudentBean.handleDataExporter}"
								fileName="reporte_observaciones" />
						</p:commandLink>
						</td>
					</tr>
					
					<tr>
				
						
						<td colspan="2" />
						<td colspan="5"><p:dataTable scrollable="true" id="observationDataTable"
								paginatorAlwaysVisible="true"  
								paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
								rowsPerPageTemplate="15,30,60" paginator="true" rows="15"
								style="width:100%" rendered="#{reportStudentBean.showProcess}"
								sortBy="dateIntervention" sortOrder="descending" emptyMessage="#{bundle['page.riskStudent.labelNoRecordFound']}"
								value="#{reportStudentBean.observationList}" var="obs">
								<f:facet name="header">  
           	 			#{bundle['page.riskStudent.labelObservationHistorical']}
        				</f:facet>  
								<p:column width="10%" sortBy="dateIntervention"
									headerText="#{bundle['page.riskStudent.labelDate']}">
								 <h:outputText value="#{obs.dateIntervention}" > </h:outputText> 	
								</p:column>
								<p:column width="6%" sortBy="#{obs.days}"
									headerText="#{bundle['page.riskStudent.labelProcessDays']}">
									<h:outputText  value="#{obs.days}">    </h:outputText>
								</p:column>
								<p:column width="15%" sortBy="#{obs.role}"
									headerText="#{bundle['page.riskStudent.labelRole']}">
									 <h:outputText value="#{obs.role}">   </h:outputText> 
								</p:column>
								<p:column width="30%" sortBy="#{obs.responsible}"
									headerText="#{bundle['page.riskStudent.labelResponsible']}">
									<h:outputText value="#{obs.responsible}">   </h:outputText> 
								</p:column>
								<p:column width="40%">
									<f:facet name="header">
										#{fn:toLowerCase(bundle['page.ins.labelObservation'])}
									</f:facet>
								  <h:outputText value="#{obs.detailObservation}">  </h:outputText>	
								</p:column>
							</p:dataTable></td>
					</tr>
				</table>
			</p:outputPanel>
		</p:outputPanel>


		<div style="text-align: center;">
			<p:commandButton id="buttonProcess" type="button"
				rendered="#{reportStudentBean.getUserSession().getDefaultGroup() ne 5 }"
				value="#{bundle['page.riskStudent.labelGiveProcess']}"
				styleClass="ui-priority-primary" onclick="validateDataProcess();"></p:commandButton>
				
			<p:commandButton action="#{reportStudentBean.closeProcess}"
				rendered="false" oncomplete="closeProcess.show();"
				value="#{bundle['page.riskStudent.labelCloseProcess']}"
				styleClass="ui-priority-primary"></p:commandButton>
			<p:commandButton value="#{bundle['page.core.labelCancel']}"
				action="#{reportStudentBean.goBack}"
				styleClass="ui-priority-primary"></p:commandButton>
		</div>

	</p:panel>

	<p:dialog widgetVar="giveProcessWV" header="Dar trámite" modal="true"
		resizable="false" draggable="true" showEffect="drop" hideEffect="fade">

		<h:outputText value="¿Desea dar trámite a este estudiante?"
			style="text-align: center;" />
		<br />
		<br />
		<div style="width: 98%;" align="center">
			<p:commandButton value="#{bundle['page.riskStudent.labelYes']}" action="#{reportStudentBean.giveProcessToReportStudent}" update="riskStudentForm"
				oncomplete="statusDialog.hide();giveProcessWV.hide();" styleClass="ui-priority-primary" onstart="statusDialog.show();"/>
			<p:commandButton value="#{bundle['page.riskStudent.labelNo']}" onclick="giveProcessWV.hide();" styleClass="ui-priority-primary" type="button"/>
		</div>
	</p:dialog>

	<p:dialog widgetVar="closeProcess" header="Cerrar proceso" modal="true"
		resizable="false" draggable="true" showEffect="drop" hideEffect="fade">

		<h:outputText
			value="¿Esta seguro de dar por finalizado el proceso de este estudiante?"
			style="text-align: center;" />
		<br />
		<br />
		<div style="width: 98%;" align="center">
			<p:commandButton value="#{bundle['page.riskStudent.labelYes']}"
				action="#{reportStudentBean.closeProcess}"
				oncomplete="closeProcess.hide();" update="@form"
				styleClass="ui-priority-primary"></p:commandButton>
			<p:commandButton value="#{bundle['page.riskStudent.labelNo']}"
				onclick="closeProcess.hide();" styleClass="ui-priority-primary"></p:commandButton>
		</div>
	</p:dialog>

</f:view>